@(preparedTableRows: List[scala.xml.Elem],
  potentialMoveOrders: play.api.libs.json.JsValue,
  potentialSupportHoldOrders: play.api.libs.json.JsValue,
  potentialSupportMoveOrders: play.api.libs.json.JsValue,
  potentialConvoyOrders: play.api.libs.json.JsValue,
	mapElement: String,
	orderHandlerURL: String)
@import com.squeryl.jdip.tables.OrderType
@import com.squeryl.jdip.tables.UnitType
@import controllers.GameScreenController
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" 
	"http://www.w3.org/TR/html4/strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" 
      xmlns:svg="http://www.w3.org/2000/svg" 
      xmlns:xlink="http://www.w3.org/1999/xlink">
<body>
<div style="margin: 0px auto;">
	@Html(mapElement)
</div>
<form method="POST" action="@orderHandlerURL">
<table style="margin: 0px auto;">
	<thead>
		<tr>
			<td>Unit Type</td>
			<td>Unit Location</td>
			<td>Order Type</td>
			<td></td>
			<td></td>
		</tr>
	</thead>
	@preparedTableRows
</table>
</form>
</body>
<script type="text/javascript" src="/public/javascripts/jquery-1.5.1.js">
</script>
<script type="text/javascript">
	function foldLeft(array, initialValue) {
		return function(accumulatingFunction) {
			var accumulator = initialValue;
			
			array.forEach(function(elem) {
				accumulator = accumulatingFunction(accumulator, elem);
			});
			
			return accumulator;
		};
	}
	
	function exists(array, existsDelegate) {
		return 
	}

	function getBasicHeading(id) {
		return "<tr class='heading " + id + "'>" + 
			"<td></td><td></td><td></td><td>Target</td><td></td></tr>";
	}
	
	function getAdvancedHeading(id) {
		return "<tr class='heading '" + id + "'>" +
			"<td></td><td></td><td></td><td>Source</td><td>Target</td></tr>"
	}

	function getPotentialMoveOrders() {
		return @Html(potentialMoveOrders.toString);
	}

	function getPotentialSupportHoldOrders() {
		return @Html(potentialSupportHoldOrders.toString);
	}

	function getPotentialSupportMoveOrders() {
		return @Html(potentialSupportMoveOrders.toString);
	}

	function getPotentialConvoyOrders() {
		return @Html(potentialConvoyOrders.toString);
	}

	function createClassName(name) {
		return "." + name;
	}
	
	function getBasicOrdersForId(id, orders) {
		return orders.filter(function(order) {
			return order.@GameScreenController.DIPLOMACY_UNIT_ID === id;
		});
	}
	
	function getAdvancedOrdersForId(id, orders) {
		return orders.filter(function(order) {
			return order.@GameScreenController.DIPLOMACY_UNIT_ID;
		});
	}
	
	function removeHeading(id) {
		$(".heading." + id).remove();
	}
	
	function createBasicOrder(id, orders, targetLocationSelector, emptyTargetMessage) {
		var basicOrdersForId = getBasicOrdersForId(id, orders);
		var basicHeading = getBasicHeading(id);
		
		var optionElements = transformBasicOrdersIntoElements(basicOrdersForId);
		var selectElement = document.createElement("select");
		selectElement.name = "moveOrder-" + id;
		optionElements.map(function(optionElement) {
			selectElement.appendChild(optionElement);
			
			return null;
		});
		
		$("#" + id).before(basicHeading);
		if (optionElements.length > 0) {
			$(targetLocationSelector).append(selectElement);
		} else {
			$(targetLocationSelector).append(emptyTargetMessage);
		}
	}
	
	function createAdvancedOrder(id, orders, targetLocationSelector, 
							emptySourceMessage, emptyTargetMessage) {
		var advancedOrdersForId = getAdvancedOrdersForId(id, orders);
		var advancedHeading = getAdvancedHeading(id);
	}
	
	function getUniqueSourceOrders(advancedOrders) {
		return foldLeft(advancedOrders, [])(function(list, order) {
			
		});
	}
	
	function getSourceOptionElements(advancedOrdersForSource) {
		return advancedOrders.map(function(order) {
			var optionElement = document.createElement("option");
			optionElement.textContent = order.@GameScreenController.SOURCE_PRESENTATION_NAME;
			optionElement.setAttribute("value", @GameScreenController.SOURCE_LOCATION_ID);
			
			return optionElement;
		});
	}
	
	function transformBasicOrdersIntoElements(orders) {
		return orders.map(function(order) {
			var option = document.createElement("option");
			option.textContent = order.@GameScreenController.PRESENTATION_NAME;
			option.setAttribute("value", order.@GameScreenController.LOCATION_ID);
		
			return option;
		});
	}

	$(document).ready(function() {
		$(".@GameScreenController.UNIT_ORDER").change(function() {
			var tableRow = this.parentElement.parentElement;
			var id = this.parentElement.parentElement.id;
			var idSelector = "#" + id;
			var targetLocationSelector = idSelector + " .@GameScreenController.TARGET_LOCATION";
			var sourceLocationSelector = idSelector + " .@GameScreenController.SOURCE_LOCATION";
			
			$(targetLocationSelector).empty();
			$(sourceLocationSelector).empty();
			removeHeading(id);
			
			switch($(this).val()) {
				case "@OrderType.HOLD": {
					break;
				}
				case "@OrderType.MOVE": {
					createBasicOrder(id, getPotentialMoveOrders(), targetLocationSelector);
					break;
				}
				case "@OrderType.SUPPORT_HOLD": {
					createBasicOrder(id, 
						getPotentialSupportHoldOrders(), 
						targetLocationSelector,
						"No support holds for this unit");
					break;
				}
				case "@OrderType.SUPPORT_MOVE": {
					break;
				}
				case "@OrderType.CONVOY": {
					break;
				}
			}
			
			
		});
	});
</script>
</html>
